"use strict";

exports.__esModule = true;
exports.default = void 0;

var _core = _interopRequireDefault(require("@svgr/core"));

var _util = require("./util");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/* eslint-disable no-underscore-dangle */
async function output(promise) {
  process.stdout.write(`${await promise}\n`);
}

async function fileCommand(program, filenames, config) {
  function stdin() {
    let code = '';
    process.stdin.setEncoding('utf8');
    process.stdin.on('readable', () => {
      const chunk = process.stdin.read();
      if (chunk !== null) code += chunk;
    });
    process.stdin.on('end', () => {
      output((0, _core.default)(code, config));
    });
  }

  if (filenames.length === 0) {
    stdin();
    return;
  }

  if (filenames.length > 1) {
    (0, _util.exitError)('Please specify only one filename or use `--out-dir` option.');
    return;
  }

  const [filename] = filenames;
  const stats = await (0, _util.stat)(filename);

  if (stats.isDirectory()) {
    (0, _util.exitError)('Directory are not supported without `--out-dir` option instead.');
  }

  output((0, _util.convertFile)(filename, config));
}

var _default = fileCommand;
exports.default = _default;